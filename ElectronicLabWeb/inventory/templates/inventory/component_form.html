{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Crear componente{% endblock %}

{% block content %}
<body data-allow-tag-create="true">
<div class="container py-4">
  <h2>Nuevo componente</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="mb-3">
      {{ form.code.label_tag }} {{ form.code }}
    </div>
    <div class="mb-3">
      {{ form.description.label_tag }} {{ form.description }}
    </div>
    <div class="mb-3">
      {{ form.location.label_tag }} {{ form.location }}
    </div>
    <div class="mb-3">
      {{ form.stock.label_tag }} {{ form.stock }}
    </div>

    <!-- Buscador de categorías -->
    <div class="mb-3">
      <label for="tagInput" class="form-label">Categorías</label>
      <input type="text" id="tagInput" class="form-control" placeholder="Buscar o crear categoría...">
      <div id="tagSuggestions" class="list-group mt-1"></div>
      <div id="selectedTags" class="mt-2"></div>
      <div id="hiddenTags">
        {% for tag in selected_tags %}
          <input type="hidden" name="tags" value="{{ tag }}">
        {% endfor %}
      </div>
    </div>

    <div class="mb-3">
      {{ form.image_file.label_tag }}
      <input type="file" name="image_file" class="form-control" accept="image/*">
    </div>
    <div class="mb-3">
      {{ form.datasheet_file.label_tag }}
      <input type="file" name="datasheet_file" class="form-control" accept="application/pdf">
    </div>
    <button type="submit" class="btn btn-primary">Crear componente</button>
  </form>
</div>
{% if form.errors %}
  <div class="alert alert-danger">
    <ul>
      {% for field in form %}
        {% for error in field.errors %}
          <li><strong>{{ field.label }}:</strong> {{ error }}</li>
        {% endfor %}
      {% endfor %}
      {% for error in form.non_field_errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}
{{ all_tags_json|json_script:"tag-list" }}

<script src="{% static 'js/tagSelector.js' %}"></script>
</body>

{% endblock %}